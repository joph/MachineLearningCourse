setwd("/data/projects/windturbine-identification/MachineLearningCourse")

source("scripts/windturbines/functions.R")

SOURCE<-"GOOGLE"
url_source<-function(x,y,z,SOURCE){

  url<-""
    
  if(SOURCE=="GOOGLE"){
    url<-paste0("http://mt0.google.com/vt/lyrs=s&hl=en&x=",x,"&y=",y,"&z=",z,"")
    
    
  }
  
  
  if(SOURCE=="BASEMAP"){
    url<-paste0("https://maps2.wien.gv.at/basemap/bmaporthofoto30cm/normal/google3857/",z,"/",y,"/",x,".jpeg")
    
  }
  
  if(SOURCE=="MAPBOX"){
    url<-paste0("http://a.tiles.mapbox.com/v4/mapbox.satellite/",z,"/",x,"/",y,".jpg?access_token=pk.eyJ1Ijoiam9waCIsImEiOiJjanZnNXF0YXUwNDlkNDNvYzZnbXUzNnp6In0.RimB9gchYB7XlfyB5ACvXA")
  }
  
  
  
  return(url)
  
  
}


RESOLUTION<-19
COUNTRY_LIST<-c("CN","DE","FR","AT","BR","IN","ES","GB","CA","MIX","GLOBAL")

all_params<-list()

for(COUNTRY in COUNTRY_LIST){
  FILTER_WINDTURBINES_KW<-1000
  
  PATH_EXPERIMENT<-
    paste0(SOURCE,
           "/RESOLUTION",
           RESOLUTION,
           "/",
           COUNTRY,
           "/")
  
  PATH_TURBINE_LOCATIONS<-paste0(
    "data/turbineLocations",
    "/",
    COUNTRY,"/")
  
  FILE_TURBINE_LOCATIONS<-paste0(
    PATH_TURBINE_LOCATIONS,
    "windturbineLocations.csv")
  
  PATH_RAW_IMAGES_TURBINES<-paste0("data/aerialImages/",
                                   PATH_EXPERIMENT,
                                   "raw/Turbines/")
  
  PATH_RAW_IMAGES_NOTURBINES<-paste0("data/aerialImages/",
                                     PATH_EXPERIMENT,
                                     "raw/NoTurbines/")
  
  PATH_RAW_IMAGES_TURBINES_MACHINE_CLASSIFIED<-paste0("data/aerialImages/",
                                                      PATH_EXPERIMENT,
                                                      "classified/Turbines/")
  
  PATH_RAW_IMAGES_NOTURBINES_MACHINE_CLASSIFIED<-paste0("data/aerialImages/",
                                                        PATH_EXPERIMENT,
                                                        "classified/NoTurbines/")
  
  PATH_RAW_IMAGES_ASSESSMENT<-paste0("data/aerialImages/",
                                     PATH_EXPERIMENT,
                                     "assessment/")
  
  #PATH_RAW_IMAGES_ASSESSMENT_TURBINES<-paste0("data/aerialImages/",
  #                                   PATH_EXPERIMENT,
  #                                   "assessment/turbines/")
  
  
  
  PATH_WINDPARK_LOCATIONS<-paste0(
    "data/windParks",
    "/",
    COUNTRY,"/")
  
  
  
  PATH_TEMP<-"data/temp/"
  
  
  PATH_LOCAL_TEMP<-"c:/temp/"
  
  
  PATH_QUALITYCHECK<-paste0(
    "qualityCheck/",
    PATH_EXPERIMENT)
  
  FILE_QUALITY_CHECK<-paste0(
    "qualityCheck/",
    PATH_EXPERIMENT,
    "qualityCheck.csv")
  
  PATH_ML_IMAGES_TURBINES_TRAIN<-paste0("data/aerialImages/",
                                        PATH_EXPERIMENT,
                                        "keras/train/Turbines/")
  
  PATH_ML_IMAGES_TURBINES_VALIDATION<-paste0("data/aerialImages/",
                                             PATH_EXPERIMENT,
                                             "keras/validation/Turbines/")
  
  
  PATH_ML_IMAGES_TURBINES_TEST<-paste0("data/aerialImages/",
                                       PATH_EXPERIMENT,
                                       "keras/test/Turbines/")
  
  
  PATH_ML_IMAGES_NOTURBINES_TRAIN<-paste0("data/aerialImages/",
                                          PATH_EXPERIMENT,
                                          "keras/train/NoTurbines/")
  
  PATH_ML_IMAGES_NOTURBINES_VALIDATION<-paste0("data/aerialImages/",
                                               PATH_EXPERIMENT,
                                               "keras/validation/NoTurbines/")
  
  
  PATH_ML_IMAGES_NOTURBINES_TEST<-paste0("data/aerialImages/",
                                         PATH_EXPERIMENT,
                                         "keras/test/NoTurbines/")
  
  PATH_OSM<-paste0("data/osm/",COUNTRY)
  
  PATH_RAW_IMAGES_OSM<-paste0("data/aerialImages/",
                                     PATH_EXPERIMENT,
                                     "osm/")
  
  FILE_OSM_TURBINE_LOCATIONS<-paste0(
    PATH_OSM,
    "/windturbines.csv")
  
  
  
  
  dir.create("config",showWarnings = FALSE)
  
  
  
  params<-data.frame(SOURCE,
                     RESOLUTION,
                     COUNTRY,
                     PATH_EXPERIMENT,
                     FILTER_WINDTURBINES_KW)
  
  paths<-data.frame(
    PATH_TURBINE_LOCATIONS,
    PATH_RAW_IMAGES_TURBINES,
    PATH_RAW_IMAGES_NOTURBINES,
    PATH_WINDPARK_LOCATIONS,
    PATH_TEMP,
    PATH_LOCAL_TEMP,
    PATH_ML_IMAGES_TURBINES_TRAIN,
    PATH_ML_IMAGES_TURBINES_VALIDATION,
    PATH_ML_IMAGES_TURBINES_TEST,
    PATH_ML_IMAGES_NOTURBINES_TRAIN,
    PATH_ML_IMAGES_NOTURBINES_VALIDATION,
    PATH_ML_IMAGES_NOTURBINES_TEST,
    PATH_QUALITYCHECK,
    PATH_RAW_IMAGES_TURBINES_MACHINE_CLASSIFIED,
    PATH_RAW_IMAGES_NOTURBINES_MACHINE_CLASSIFIED,
    PATH_RAW_IMAGES_ASSESSMENT,
    PATH_OSM,
    PATH_RAW_IMAGES_OSM
    
    #,
    #PATH_RAW_IMAGES_ASSESSMENT_TURBINES
  )
  
  sapply(unlist(paths),
         function(x){
           print(as.character(x))
           dir.create(as.character(x),showWarnings=FALSE,recursive = TRUE)})
  
  
  files<-data.frame(FILE_QUALITY_CHECK,
                    FILE_TURBINE_LOCATIONS,
                    FILE_OSM_TURBINE_LOCATIONS)
  
  
  ####write config files
  params<-data.frame(params,
                     paths,
                     files)
  
  write_csv(params,paste0("config/params",COUNTRY,".csv"))
  all_params[[COUNTRY]]<-params
}

CURRENT_COUNTRY<-"BR"
